import{_ as e,o as n,c as a,a as s}from"./app-8ca7f52c.js";const l={},r=s(`<h1 id="centos7-内核升级" tabindex="-1"><a class="header-anchor" href="#centos7-内核升级" aria-hidden="true">#</a> CentOS7 内核升级</h1><h2 id="_1-查看系统内核版本" tabindex="-1"><a class="header-anchor" href="#_1-查看系统内核版本" aria-hidden="true">#</a> 1. 查看系统内核版本</h2><p>查看版本信息及相关内容</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">uname</span> <span class="token parameter variable">-a</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="_2-更新系统版本" tabindex="-1"><a class="header-anchor" href="#_2-更新系统版本" aria-hidden="true">#</a> 2. 更新系统版本</h2><p>会修改所有已安装的包和配置，慎重执行。</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>yum <span class="token parameter variable">-y</span> update
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>可选 yum -y upgrade 只升级包不修改配置。</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>yum <span class="token parameter variable">-y</span> upgrade
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="_3-安装-elrepo-源" tabindex="-1"><a class="header-anchor" href="#_3-安装-elrepo-源" aria-hidden="true">#</a> 3. 安装 ELRepo 源</h2><div class="hint-container tip"><p class="hint-container-title">提示</p><p>ELRepo 仓库是基于社区的用于企业级 Linux 仓库，提供对 RedHat Enterprise (RHEL) 和 其他基于 RHEL 的 Linux 发行版（CentOS、Scientific、Fedora 等）的支持。</p></div><p>导入公钥</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">rpm</span> <span class="token parameter variable">--import</span> https://www.elrepo.org/RPM-GPG-KEY-elrepo.org
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>安装 yum 源</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>yum <span class="token function">install</span> https://www.elrepo.org/elrepo-release-7.el7.elrepo.noarch.rpm <span class="token parameter variable">-y</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="_4-查询可用内核版本" tabindex="-1"><a class="header-anchor" href="#_4-查询可用内核版本" aria-hidden="true">#</a> 4.查询可用内核版本</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>yum <span class="token parameter variable">--disablerepo</span><span class="token operator">=</span><span class="token string">&quot;*&quot;</span> <span class="token parameter variable">--enablerepo</span><span class="token operator">=</span><span class="token string">&quot;elrepo-kernel&quot;</span> list available
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>输出</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>Loaded plugins: fastestmirror
Loading mirror speeds from cached hostfile
 * elrepo-kernel: hkg.mirror.rackspace.com
Available Packages
kernel-lt.x86_64                                                                   <span class="token number">5.4</span>.258-1.el7.elrepo                                                  elrepo-kernel
kernel-lt-devel.x86_64                                                             <span class="token number">5.4</span>.258-1.el7.elrepo                                                  elrepo-kernel
kernel-lt-doc.noarch                                                               <span class="token number">5.4</span>.258-1.el7.elrepo                                                  elrepo-kernel
kernel-lt-headers.x86_64                                                           <span class="token number">5.4</span>.258-1.el7.elrepo                                                  elrepo-kernel
kernel-lt-tools.x86_64                                                             <span class="token number">5.4</span>.258-1.el7.elrepo                                                  elrepo-kernel
kernel-lt-tools-libs.x86_64                                                        <span class="token number">5.4</span>.258-1.el7.elrepo                                                  elrepo-kernel
kernel-lt-tools-libs-devel.x86_64                                                  <span class="token number">5.4</span>.258-1.el7.elrepo                                                  elrepo-kernel
kernel-ml-devel.x86_64                                                             <span class="token number">6.5</span>.7-1.el7.elrepo                                                    elrepo-kernel
kernel-ml-doc.noarch                                                               <span class="token number">6.5</span>.7-1.el7.elrepo                                                    elrepo-kernel
kernel-ml-headers.x86_64                                                           <span class="token number">6.5</span>.7-1.el7.elrepo                                                    elrepo-kernel
kernel-ml-tools.x86_64                                                             <span class="token number">6.5</span>.7-1.el7.elrepo                                                    elrepo-kernel
kernel-ml-tools-libs.x86_64                                                        <span class="token number">6.5</span>.7-1.el7.elrepo                                                    elrepo-kernel
kernel-ml-tools-libs-devel.x86_64                                                  <span class="token number">6.5</span>.7-1.el7.elrepo                                                    elrepo-kernel
perf.x86_64                                                                        <span class="token number">5.4</span>.258-1.el7.elrepo                                                  elrepo-kernel
python-perf.x86_64                                                                 <span class="token number">5.4</span>.258-1.el7.elrepo                                                  elrepo-kernel
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>kernel-ml 和 kernel-lt 二者的区别：</p><ul><li>kernel-ml 软件包是根据 Linux Kernel Archives 的主线稳定分支提供的源构建的。 内核配置基于默认的 RHEL-7 配置，并根据需要启用了添加的功能。 这些软件包有意命名为 kernel-ml，以免与 RHEL-7 内核发生冲突，因此，它们可以与常规内核一起安装和更新。</li><li>kernel-lt 包是从 Linux Kernel Archives 提供的源代码构建的，就像 kernel-ml 软件包一样。 不同之处在于 kernel-lt 基于长期支持分支，而 kernel-ml 基于主线稳定分支。</li></ul><h2 id="_5-安装最新的稳定版本内核" tabindex="-1"><a class="header-anchor" href="#_5-安装最新的稳定版本内核" aria-hidden="true">#</a> 5. 安装最新的稳定版本内核</h2><p>大于 6.3 才符合要求，安装 ml 稳定版本</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>yum <span class="token parameter variable">-y</span> <span class="token parameter variable">--enablerepo</span><span class="token operator">=</span>elrepo-kernel <span class="token function">install</span> kernel-ml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>会默认安装 ml 的最新版本，即 6.5.7-1.el7.elrepo 。</p><p>安装完成后需要设置 grub2，即内核默认启动项</p><h2 id="_6-设置-grub2" tabindex="-1"><a class="header-anchor" href="#_6-设置-grub2" aria-hidden="true">#</a> 6. 设置 grub2</h2><p>内核安装好后，需要设置为默认启动选项并重启后才会生效</p><p>查看系统上的所有可用内核：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">awk</span> -F<span class="token punctuation">\\</span>&#39; <span class="token string">&#39;$1==&quot;menuentry &quot; {print i++ &quot; : &quot; $2}&#39;</span> /etc/grub2.cfg
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>输出</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token number">0</span> <span class="token builtin class-name">:</span> CentOS Linux <span class="token punctuation">(</span><span class="token number">6.5</span>.7-1.el7.elrepo.x86_64<span class="token punctuation">)</span> <span class="token number">7</span> <span class="token punctuation">(</span>Core<span class="token punctuation">)</span>
<span class="token number">1</span> <span class="token builtin class-name">:</span> CentOS Linux <span class="token punctuation">(</span><span class="token number">3.10</span>.0-1160.99.1.el7.x86_64<span class="token punctuation">)</span> <span class="token number">7</span> <span class="token punctuation">(</span>Core<span class="token punctuation">)</span>
<span class="token number">2</span> <span class="token builtin class-name">:</span> CentOS Linux <span class="token punctuation">(</span><span class="token number">3.10</span>.0-957.21.3.el7.x86_64<span class="token punctuation">)</span> <span class="token number">7</span> <span class="token punctuation">(</span>Core<span class="token punctuation">)</span>
<span class="token number">3</span> <span class="token builtin class-name">:</span> CentOS Linux <span class="token punctuation">(</span><span class="token number">3.10</span>.0-957.el7.x86_64<span class="token punctuation">)</span> <span class="token number">7</span> <span class="token punctuation">(</span>Core<span class="token punctuation">)</span>
<span class="token number">4</span> <span class="token builtin class-name">:</span> CentOS Linux <span class="token punctuation">(</span><span class="token number">0</span>-rescue-20190711105006363114529432776998<span class="token punctuation">)</span> <span class="token number">7</span> <span class="token punctuation">(</span>Core<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>刚刚安装的内核即 <code>0 : CentOS Linux (6.5.7-1.el7.elrepo.x86_64) 7 (Core)</code></p><p>我们需要把 grub2 默认设置为 0</p><p>方法 1：通过 grub2-set-default 0 命令设置</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>grub2-set-default <span class="token number">0</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>方法 2：编辑 /etc/default/grub 文件，编辑（e）将 GRUB_DEFAULT 设置为 0， 修改完成后保存退出（：wq）</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">vim</span> /etc/default/grub
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="_7-生成-grub-配置文件并重启" tabindex="-1"><a class="header-anchor" href="#_7-生成-grub-配置文件并重启" aria-hidden="true">#</a> 7. 生成 grub 配置文件并重启</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>grub2-mkconfig <span class="token parameter variable">-o</span> /boot/grub2/grub.cfg
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>重启服务器</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">reboot</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="_8-验证是否成功安装" tabindex="-1"><a class="header-anchor" href="#_8-验证是否成功安装" aria-hidden="true">#</a> 8. 验证是否成功安装</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">uname</span> <span class="token parameter variable">-a</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="_9-删除旧内核-可选" tabindex="-1"><a class="header-anchor" href="#_9-删除旧内核-可选" aria-hidden="true">#</a> 9. 删除旧内核（可选）</h2><p>查看内核包</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">rpm</span> <span class="token parameter variable">-qa</span> <span class="token operator">|</span> <span class="token function">grep</span> kernel
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>输出</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>kernel-3.10.0-1160.99.1.el7.x86_64
kernel-devel-3.10.0-1160.99.1.el7.x86_64
kernel-3.10.0-957.el7.x86_64
kernel-tools-libs-3.10.0-1160.99.1.el7.x86_64
kernel-3.10.0-957.21.3.el7.x86_64
kernel-tools-3.10.0-1160.99.1.el7.x86_64
kernel-devel-3.10.0-957.21.3.el7.x86_64
kernel-ml-6.5.7-1.el7.elrepo.x86_64
kernel-headers-3.10.0-1160.99.1.el7.x86_64
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可选择删除 3.10 版本的内核</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>yum remove kernel-3.10.0*
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>卸载其他内核工具包</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>yum remove kernel-*-3.10.0*
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>会卸载一些对内核 headers 依赖的安装包，比如 gcc、gcc-c++ 之类的。不过不要紧，我们可以在安装完最新版内核 headers 后再重新安装回来即可。</p><p>安装匹配新版本内核工具包</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>yum <span class="token parameter variable">-y</span> <span class="token parameter variable">--enablerepo</span><span class="token operator">=</span>elrepo-kernel <span class="token function">install</span> kernel-ml*
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>安装 gcc 等</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>yum <span class="token function">install</span> gcc gcc-c++ glibc-devel glibc-headers <span class="token parameter variable">-y</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="_10-手动下载内核包" tabindex="-1"><a class="header-anchor" href="#_10-手动下载内核包" aria-hidden="true">#</a> 10. 手动下载内核包</h2><p>http://mirrors.coreix.net/elrepo-archive-archive/kernel/el7/x86_64/RPMS/</p><p>搜索 <code>6.5.7-1</code></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token assign-left variable">KERNEL_VERSION</span><span class="token operator">=</span><span class="token number">6.5</span>.7-1

<span class="token function">wget</span> http://mirrors.coreix.net/elrepo-archive-archive/kernel/el7/x86_64/RPMS/kernel-ml-<span class="token variable">\${KERNEL_VERSION}</span>.el7.elrepo.x86_64.rpm

<span class="token function">wget</span> http://mirrors.coreix.net/elrepo-archive-archive/kernel/el7/x86_64/RPMS/kernel-ml-devel-<span class="token variable">\${KERNEL_VERSION}</span>.el7.elrepo.x86_64.rpm

<span class="token function">wget</span> http://mirrors.coreix.net/elrepo-archive-archive/kernel/el7/x86_64/RPMS/kernel-ml-doc-<span class="token variable">\${KERNEL_VERSION}</span>.el7.elrepo.noarch.rpm

<span class="token function">wget</span> http://mirrors.coreix.net/elrepo-archive-archive/kernel/el7/x86_64/RPMS/kernel-ml-headers-<span class="token variable">\${KERNEL_VERSION}</span>.el7.elrepo.x86_64.rpm

<span class="token function">wget</span> http://mirrors.coreix.net/elrepo-archive-archive/kernel/el7/x86_64/RPMS/kernel-ml-tools-<span class="token variable">\${KERNEL_VERSION}</span>.el7.elrepo.x86_64.rpm

<span class="token function">wget</span> http://mirrors.coreix.net/elrepo-archive-archive/kernel/el7/x86_64/RPMS/kernel-ml-tools-libs-<span class="token variable">\${KERNEL_VERSION}</span>.el7.elrepo.x86_64.rpm

<span class="token function">wget</span> http://mirrors.coreix.net/elrepo-archive-archive/kernel/el7/x86_64/RPMS/kernel-ml-tools-libs-devel-<span class="token variable">\${KERNEL_VERSION}</span>.el7.elrepo.x86_64.rpm
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,62),i=[r];function p(d,c){return n(),a("div",null,i)}const o=e(l,[["render",p],["__file","CentOS7 内核升级.html.vue"]]);export{o as default};
