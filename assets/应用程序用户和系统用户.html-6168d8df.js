import{_ as i,r as c,o as d,c as u,b as a,d as e,e as l,w as s,a as n}from"./app-8ca7f52c.js";const h={},m=n(`<h1 id="应用程序用户和系统用户" tabindex="-1"><a class="header-anchor" href="#应用程序用户和系统用户" aria-hidden="true">#</a> 应用程序用户和系统用户</h1><h2 id="用户" tabindex="-1"><a class="header-anchor" href="#用户" aria-hidden="true">#</a> 用户</h2><p>集群中的 MySQL 用户帐户可以分为两个不同的组：</p><ul><li>应用程序级用户：非特权用户帐户。</li><li>系统级用户：自动执行集群部署和管理任务所需的帐户，例如 Percona XtraDB 集群运行状况检查或 ProxySQL 集成。</li></ul><p>由于这两组用户帐户的用途不同，因此在以下各节中分别考虑它们。</p><h2 id="非特权用户" tabindex="-1"><a class="header-anchor" href="#非特权用户" aria-hidden="true">#</a> 非特权用户</h2><p>默认情况下，不会创建非特权（常规用途）用户帐户。如果您需要通用用户，请运行以下命令：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>kubectl run <span class="token parameter variable">-it</span> <span class="token parameter variable">--rm</span> percona-client <span class="token parameter variable">--image</span><span class="token operator">=</span>percona:8.0 <span class="token parameter variable">--restart</span><span class="token operator">=</span>Never -- mysql -hcluster1-pxc <span class="token parameter variable">-uroot</span> <span class="token parameter variable">-proot_password</span>

GRANT ALL PRIVILEGES ON database1.* TO <span class="token string">&#39;user1&#39;</span>@<span class="token string">&#39;%&#39;</span> IDENTIFIED BY <span class="token string">&#39;password1&#39;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="hint-container tip"><p class="hint-container-title">注意</p><p>由于 MySQL 5.7.5 中引入的复制特定限制，此处的 MySQL 密码不应超过 32 个字符。</p></div><p>验证用户是否已成功创建。如果成功，以下命令将让您通过 ProxySQL 成功登录 MySQL shell：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>kubectl run <span class="token parameter variable">-it</span> <span class="token parameter variable">--rm</span> percona-client <span class="token parameter variable">--image</span><span class="token operator">=</span>percona:8.0 <span class="token parameter variable">--restart</span><span class="token operator">=</span>Never -- <span class="token function">bash</span> <span class="token parameter variable">-il</span>

mysql <span class="token parameter variable">-h</span> cluster1-proxysql <span class="token parameter variable">-uuser1</span> <span class="token parameter variable">-ppassword1</span>

mysql<span class="token operator">&gt;</span> SELECT * FROM database1.table1 LIMIT <span class="token number">1</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>您也可以尝试执行任何简单的 SQL 语句，以确保已成功授予权限。</p><h2 id="系统用户" tabindex="-1"><a class="header-anchor" href="#系统用户" aria-hidden="true">#</a> 系统用户</h2><p>为了自动部署和管理集群组件，Operator 需要系统级 Percona XtraDB 集群用户。</p><p>这些用户的凭据存储为 Kubernetes Secrets 对象。在启动 Percona XtraDB 集群之前，Operator 需要 Kubernetes Secrets。它将使用现有的 Secrets，或者使用随机生成的密码创建一个新的 Secrets 对象（如果该对象不存在）。所需的 Secret 的名称（ cluster1-secrets 默认）应在 deploy/cr.yaml 配置文件的 spec.secretsName 选项中设置。</p><p>下表显示了系统用户的名称和用途。</p><div class="hint-container warning"><p class="hint-container-title">警告</p><p>这些用户不应用于运行应用程序。</p></div>`,17),b=a("thead",null,[a("tr",null,[a("th",null,"用户目的"),a("th",null,"用户名"),a("th",null,"密码 Secret Key"),a("th",null,"描述")])],-1),k=a("tr",null,[a("td",null,"Admin"),a("td",null,"root"),a("td",null,"root"),a("td",null,"数据库管理用户，可由应用程序根据需要使用")],-1),v=a("tr",null,[a("td",null,"ProxySQLAdmin"),a("td",null,"proxyadmin"),a("td",null,"proxyadmin"),a("td",null,"ProxySQL 管理用户，可用于添加通用 ProxySQL 用户")],-1),_=a("tr",null,[a("td",null,"Backup"),a("td",null,"xtrabackup"),a("td",null,"xtrabackup"),a("td",null,"运行备份的用户，被授予 all 满足时间点恢复需求的权限")],-1),y=a("tr",null,[a("td",null,"Cluster Check"),a("td",null,"clustercheck"),a("td",null,"clustercheck"),a("td",null,"用户在 v1.12.0 中已弃用，在下一个版本之一中不可用")],-1),g=a("tr",null,[a("td",null,"Monitoring"),a("td",null,"monitor"),a("td",null,"monitor"),a("td",null,"用户用于内部监控目的，如活动/就绪情况检查和 PMM 代理")],-1),x=a("td",null,"PMM Server Password",-1),S={href:"https://docs.percona.com/percona-operator-for-mysql/pxc/operator#pmm-serveruser",target:"_blank",rel:"noopener noreferrer"},w=a("td",null,"pmmserver",-1),f=a("td",null,"用于访问 PMM 服务器的密码。自 Operator 1.11.0 起，不推荐使用基于密码的授权方法。请改用基于令牌的授权",-1),L=a("tr",null,[a("td",null,"Operator Admin"),a("td",null,"operator"),a("td",null,"operator"),a("td",null,"数据库管理用户，只能由操作员使用")],-1),P=a("tr",null,[a("td",null,"Replication"),a("td",null,"replication"),a("td",null,"replication"),a("td",null,"跨站点 Percona XtraDB 集群所需的管理用户")],-1),M=n(`<h3 id="yaml-对象格式" tabindex="-1"><a class="header-anchor" href="#yaml-对象格式" aria-hidden="true">#</a> YAML 对象格式</h3><p>这些用户的 Secrets 对象的默认名称是 cluster1-secrets 并且可以在集群 spec.secretName 的 CR 中设置为不同的名称。当您自己创建对象时，它应与以下简单格式匹配：</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Secret
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> cluster1<span class="token punctuation">-</span>secrets
<span class="token key atrule">type</span><span class="token punctuation">:</span> Opaque
<span class="token key atrule">stringData</span><span class="token punctuation">:</span>
  <span class="token key atrule">root</span><span class="token punctuation">:</span> root_password
  <span class="token key atrule">xtrabackup</span><span class="token punctuation">:</span> backup_password
  <span class="token key atrule">monitor</span><span class="token punctuation">:</span> monitory
  <span class="token key atrule">clustercheck</span><span class="token punctuation">:</span> clustercheckpassword
  <span class="token key atrule">proxyadmin</span><span class="token punctuation">:</span> admin_password
  <span class="token key atrule">operator</span><span class="token punctuation">:</span> operatoradmin
  <span class="token key atrule">replication</span><span class="token punctuation">:</span> repl_password
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面的示例与包含默认密码的 deploy/secrets.yaml 中提供的内容相匹配。您不应该在生产中使用它们，但它们的存在是为了帮助自动化测试或在开发环境中简单使用。</p><p>如您所见，由于我们在创建 Secrets 对象时使用了 stringData 该类型，因此每个键/值对的所有值都以纯文本格式表示，从用户的角度来看很方便。但是生成的 Secrets 对象包含存储为 data - 即 base64 编码的字符串的密码。如果要更新任何字段，则需要将值编码为 base64 格式。为此，您可以在本地 shell 中运行 <code>echo -n &quot;password&quot; | base64 --wrap=0</code> （或者仅在 Apple macOS 的情况下 <code>echo -n &quot;password&quot; | base64</code> ）以获取有效值。</p><p>例如，可以使用以下命令在 cluster1-secrets 对象中设置管理员用户的密码： new_password</p>`,6),O=a("div",{class:"language-bash line-numbers-mode","data-ext":"sh"},[a("pre",{class:"language-bash"},[a("code",null,[e("kubectl patch secret/cluster1-secrets "),a("span",{class:"token parameter variable"},"-p"),e(),a("span",{class:"token string"},`'{"data":{"root": "'`),a("span",{class:"token variable"},[a("span",{class:"token variable"},"$("),a("span",{class:"token builtin class-name"},"echo"),e(),a("span",{class:"token parameter variable"},"-n"),e(" new_password "),a("span",{class:"token operator"},"|"),e(" base64 "),a("span",{class:"token parameter variable"},"--wrap"),a("span",{class:"token operator"},"="),a("span",{class:"token number"},"0"),a("span",{class:"token variable"},")")]),a("span",{class:"token string"},`'"}}'`),e(`
`)])]),a("div",{class:"line-numbers","aria-hidden":"true"},[a("div",{class:"line-number"})])],-1),q=a("div",{class:"language-bash line-numbers-mode","data-ext":"sh"},[a("pre",{class:"language-bash"},[a("code",null,[e("kubectl patch secret/cluster1-secrets "),a("span",{class:"token parameter variable"},"-p"),e(),a("span",{class:"token string"},`'{"data":{"root": "'`),a("span",{class:"token variable"},[a("span",{class:"token variable"},"$("),a("span",{class:"token builtin class-name"},"echo"),e(),a("span",{class:"token parameter variable"},"-n"),e(" new_password "),a("span",{class:"token operator"},"|"),e(" base64"),a("span",{class:"token variable"},")")]),a("span",{class:"token string"},`'"}}'`),e(`
`)])]),a("div",{class:"line-numbers","aria-hidden":"true"},[a("div",{class:"line-number"})])],-1),E=n('<h3 id="密码轮换策略和时间" tabindex="-1"><a class="header-anchor" href="#密码轮换策略和时间" aria-hidden="true">#</a> 密码轮换策略和时间</h3><p>当用户密钥发生更改时，操作员会创建必要的事务来更改密码。这种轮换几乎是即时发生的（延迟可能长达几秒钟），除了更改密码之外，不需要采取任何操作。</p><div class="hint-container tip"><p class="hint-container-title">注意</p><p>请不要在 CR 中更改 secretName 选项，请在 secrets 对象本身内进行更改。</p></div><p>从 Operator 版本 1.13.0 开始，系统用户将使用该 PASSWORD EXPIRE NEVER 策略创建。此外，当 Operator 升级到 1.13.0 时，相同的策略会自动应用于现有集群上的系统用户。</p><h3 id="在-mysql-中标记系统用户" tabindex="-1"><a class="header-anchor" href="#在-mysql-中标记系统用户" aria-hidden="true">#</a> 在 MySQL 中标记系统用户</h3>',5),N={href:"https://dev.mysql.com/doc/refman/8.0/en/account-categories.html",target:"_blank",rel:"noopener noreferrer"},A=n('<h2 id="开发模式" tabindex="-1"><a class="header-anchor" href="#开发模式" aria-hidden="true">#</a> 开发模式</h2><p>为了简化开发和测试， <code>deploy/secrets.yaml</code> secrets 文件包含 Percona XtraDB Cluster 系统用户的默认密码。</p><p>这些开发模式凭据来自 <code>deploy/secrets.yaml</code> ：</p><table><thead><tr><th>Secret Key</th><th>Secret Value</th></tr></thead><tbody><tr><td>root</td><td>root_password</td></tr><tr><td>xtrabackup</td><td>backup_password</td></tr><tr><td>monitor</td><td>monitor</td></tr><tr><td>clustercheck</td><td>clustercheckpassword</td></tr><tr><td>proxyadmin</td><td>admin_password</td></tr><tr><td>operator</td><td>operatoradmin</td></tr><tr><td>replication</td><td>repl_password</td></tr></tbody></table><div class="hint-container warning"><p class="hint-container-title">警告</p><p>不要在生产环境中使用默认的 Percona XtraDB Cluster 用户密码！</p></div>',5);function Q(B,D){const o=c("ExternalLinkIcon"),p=c("Tabs");return d(),u("div",null,[m,a("table",null,[b,a("tbody",null,[k,v,_,y,g,a("tr",null,[x,a("td",null,[e("应通过 "),a("a",S,[e("operator options"),l(o)]),e(" 进行设置")]),w,f]),L,P])]),M,l(p,{id:"208",data:[{id:"在 Linux 中"},{id:"在 macOS 中"}]},{title0:s(({value:t,isActive:r})=>[e("在 Linux 中")]),title1:s(({value:t,isActive:r})=>[e("在 macOS 中")]),tab0:s(({value:t,isActive:r})=>[O]),tab1:s(({value:t,isActive:r})=>[q]),_:1}),E,a("p",null,[e("从 MySQL 8.0.16 开始，实现了一个名为帐户类别的新功能，它允许我们将系统用户标记为帐户用户。有关更多详细信息，请参阅有关此功能的"),a("a",N,[e("官方文档"),l(o)]),e("。")]),A])}const C=i(h,[["render",Q],["__file","应用程序用户和系统用户.html.vue"]]);export{C as default};
